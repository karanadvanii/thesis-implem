<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: content: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <!--
      <script src="components/loader.js"></script>
      <link rel="stylesheet" href="components/loader.css">
    --> <!--"monaca:transpile": "npm run build",-->
    <!--  <link rel="stylesheet" href="css/style.css">-->
    <link rel="manifest" href="/manifest.json">
    <link rel="shortcut icon" href="images/icons/Icon-48.png" type="image/x-icon">
    <link rel="icon" href="images/icons/Icon-48.png" type="image/x-icon">
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
    <link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
    <link href='//fonts.googleapis.com/css?family=Oswald:400,300,700' rel='stylesheet' type='text/css'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Staffbase | Offline-First Web Application for Internal Communications</title>
    <script src="script/jquery-1.11.1.min.js"></script>
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker
                .register("/service-worker.js")
                .then(function(registration) {
                    console.log(
                        "ServiceWorker registration successful with scope: ",
                        registration.scope
                    );
                })
                .catch(function(err) {
                    console.log("ServiceWorker registration failed: ", err);
                });
        }
    </script>
</head>
<body>

<div class="topnav">
    <a href="index.html" class="active logo"><img src="images/staffbase.png"></a>
    <div id="myLinks">
        <!--<a href="#news">Post News</a>-->
        <a href="author.html">Employee Directory</a>
        <!--<a href="#about">About</a>-->
    </div>
    <a href="javascript:void(0);" class="icon" onclick="myFunction()">
        <i class="fa fa-bars"></i>
    </a>
</div>

<div class="container">
    <div class="col-xs-12 col-sm-12 col-md-8 wrapper">
        <form id="new-post-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" class="form-control" id="title" placeholder="Enter title">
            </div>
            <div class="form-group">
                <label for="teaser">Teaser</label>
                <input type="text" class="form-control" id="teaser" placeholder="Enter teaser">
            </div>
            <div class="form-group">
                <label for="content">Content</label>
                <textarea class="form-control" id="content" rows="3"></textarea>
            </div>
            <div class="custom-file">
                <label class="custom-file-label" for="customFile">Choose file</label>
                <input type="file" class="custom-file-input" id="customFile">
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>

    <div class="col-xs-12 col-sm-12 col-md-4">
        <div class="col-xs-12 col-sm-12 col-md-12" class="rhs-heading">
            <h4>Quick Links</h4>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 frame-rhs">
            <a href="#" class="side-links">People Experience</a>
            <hr class="hr-side" >
            <a href="#" class="side-links">Customer Care</a>
            <hr class="hr-side" >
            <a href="#" class="side-links">Customer Success Manahement</a>
            <hr class="hr-side" >
            <a href="#" class="side-links">Development</a>
            <hr class="hr-side" >
            <a href="#" class="side-links">Partners / Alliances</a>
            <hr class="hr-side" >
            <a href="#" class="side-links">Product</a>
            <hr class="hr-side" >
            <a href="#" class="side-links">Sales</a>
            <hr class="hr-side" >
            <a href="#" class="side-links">Finance</a>
            <hr class="hr-side" >
            <a href="#" class="side-links">Information Security</a>
        </div>
        <br>
        <div class="col-xs-12 col-sm-12 col-md-12">
            <h4>Documents</h4>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 frame-rhs">
            <a href="files/dummy.pdf" class="side-links"><img src="images/pdf.png" height="20" width="20">&nbsp;&nbsp;AcrobatReader.pdf</a>
            <hr class="hr-side" >
            <a href="files/dummy.pptx" class="side-links"><img src="images/ppt.png" height="20" width="20">&nbsp;&nbsp;Powerpoint.ppt</a>
            <hr class="hr-side" >
            <a href="files/dummy.doc" class="side-links"><img src="images/doc.png" height="20" width="20">&nbsp;&nbsp;Word.doc</a>
            <hr class="hr-side" >
            <a href="files/dummy.xls" class="side-links"><img src="images/xls.png" height="20" width="20">&nbsp;&nbsp;ExcelSheet.xls</a>
            <hr class="hr-side" >
        </div>
    </div>
</div>
<div class="clearfix"></div>
</body>
</html>
<script src="script/new-post.js" type="module">
    // Temporarily added functions here because dynamic import doesn't work properly in such scenario.
    import {Queue} from '../node_modules/workbox-background-sync/Queue.js';
    const newPostForm = document.getElementById('new-post-form');
    newPostForm.addEventListener('submit', async function (e) {
        e.preventDefault();
        const [title, teaser, content, fileInput] = e.target.elements;
        const data = {
            published: "2016-07-22T09:14:39.171Z",
            contents: {
                en_US: {
                    title: title.value,
                    teaser: teaser.value,
                    content: content.value,
                    image: JSON.stringify(await postImage(fileInput.files[0]))
                }
            }
        };
        await postData(data);
        history.back();
    });

    function postData(data) {
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        myHeaders.append("Authorization", "Basic NWRkZDVkOTFlYTJkMTU3ZjYxNWIyOGYxOn59UlluXk55V0NdMn1YRE0wLF15cW1Kam8hUC1EYTR1OS1BSXtfRVZ6dG4wY3Npcnt7NlpXRElSbV1qbE1PeEo=");

        let requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: JSON.stringify(data),
            redirect: 'follow'
        };

        return fetch("https://de-t1.eyo.net/api/channels/5e2629736199791aeb6d740f/posts", requestOptions)
            .then(response => response.text())
            .then(result => console.log(result))
            .catch(error => console.log('error', error));
    }

    function postImage(file) {
        const formData = new FormData();
        formData.append('type', 'article');
        formData.append('image', file);

        const options = {
            method: 'POST',
            body: formData,
        };
        return fetch("https://de-t1.eyo.net/upload/images;wesessid=m3xtuazvfnxsvdiwamnrq61k5193", options)
            .then(response => response.json());
    }


    const queue = new Queue('myQueueName');
    self.addEventListener('fetch', (event) => {
        // Clone the request to ensure it's safe to read when
        // adding to the Queue.
        console.log('Syncing!!!');
        const promiseChain = fetch(event.request.clone()).catch((err) => {
            return queue.pushRequest({request: event.request});
        });

        event.waitUntil(promiseChain);
    });
</script>
<script>
    function myFunction() {
        var x = document.getElementById("myLinks");
        if (x.style.display === "block") {
            x.style.display = "none";
        } else {
            x.style.display = "block";
        }
    }
</script>

